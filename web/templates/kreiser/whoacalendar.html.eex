<!DOCTYPE html>
<!--======================= CODE BY DOMINIK KREISER ==========================-->
<!--============================ COPYRIGHT 2017 ==============================-->
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>WhoaCalendar</title>
    <script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js?ver=1.3.2'></script>
    <!--link rel="stylesheet" type="text/css" href="<%= static_path(@conn, "/css/app.css") %>"/-->
    <link href="https://fonts.googleapis.com/css?family=Neucha" rel="stylesheet"/>
    <link rel="icon" href="icon.png"/>
<style>
    *
    {
        box-sizing: border-box;
    }

    body
    {
        padding:0;
        margin:0;
        height:100%;
        background-image:url("<%= static_path(@conn, "/images/bcg.png") %>");
        bacground-repeat:repeat;
    }

    button
    {
        font-family:"Neucha";
        color:rgba(230,230,230,1);
        text-align:center;
        cursor:pointer;
    }

    button:focus
    {
        outline:none;
    }

    button:active
    {
        outline:none;
    }

    #whole
    {
        position:absolute;
        height:100%;
        width:100%;

        background: rgba(21,56,69,0.9);
        background: -moz-linear-gradient(45deg, rgba(21,56,69,0.9) 0%, rgba(18,78,130,0.9) 100%);
        background: -webkit-gradient(left bottom, right top, color-stop(0%, rgba(21,56,69,0.9)), color-stop(100%, rgba(18,78,130,0.9)));
        background: -webkit-linear-gradient(45deg, rgba(21,56,69,0.9) 0%, rgba(18,78,130,0.9) 100%);
        background: -o-linear-gradient(45deg, rgba(21,56,69,0.9) 0%, rgba(18,78,130,0.9) 100%);
        background: -ms-linear-gradient(45deg, rgba(21,56,69,0.9) 0%, rgba(18,78,130,0.9) 100%);
        background: linear-gradient(45deg, rgba(21,56,69,0.9) 0%, rgba(18,78,130,0.9) 100%);
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#153845', endColorstr='#124e82', GradientType=1 );
    }

    #title
    {
        width:100%;
        margin-top:4.2%;

        color:white;
        font-size:9vh;
        font-family:"Neucha";
        text-align:center;

        text-shadow:6px 6px 0px rgba(0,0,0,0.5);
    }

    #main_buttonbar
    {
        width:100%;
        height:5.5%;
        margin-top:2vh;
    }

    .mainbutton
    {
        width:10%;
        height:100%;
        float:left;
        margin-left:2%;
        margin-top:0;

        background-color:rgba(0,2,9,0.17);
        font-size:1.5vh;
        text-shadow:1px 1px 1px rgba(0,0,0,0.7);

        border:3px solid rgba(255,255,255,0.65);
        border-radius:30px;

        box-shadow:0px 8px 0 rgba(0,2,10,0.4);

        cursor:pointer;
        transition:0.3s border, 0.3s box-shadow, 0.3s text-shadow,
        0.3s background-color, 0.3s margin-top;
    }

    .mainbutton:hover
    {
        border:3px solid rgba(255,255,255,0.9);
        text-shadow:0px 0px 1px rgba(0,0,0,0.4);
        text-shadow:0px 0px 6px rgba(255,255,255,0.5);
        background-color:rgba(40,220,255,0.3);
    }

    .mainbutton_pressed
    {
        background-color:rgba(0,2,9,0.05);
        box-shadow:0px 0px 0 rgba(0,2,10,0.4);
        margin-top:8px;
    }

    #leftbutton
    {
        margin-left:33%;
    }

    #container
    {
        position:relative;
        width:100%;
        height:62%;
    }

    #zone_calculator
    {
        display:block;
        position:absolute;
        width:24%;
        height:100%;
        margin-top:4vh;
        margin-left:38%;

        border:4px solid rgba(255,255,255,0.65);
        border-radius:50px;

        box-shadow:1px 1px 0px 4px rgba(0,0,0,0.3);

        transition: 0.4s opacity;
    }

    #zone_about
    {
        display:block;
        position:absolute;
        width:28%;
        height:100%;
        margin-top:4vh;
        margin-left:36%;

        border:4px solid rgba(255,255,255,0.65);
        border-radius:50px;

        box-shadow:1px 1px 0px 4px rgba(0,0,0,0.3);

        transition: 0.4s opacity;
    }

    #zone_explore
    {
        display:block;
        position:absolute;
        width:96%;
        height:100%;
        margin-left:2%;

        transition: 0.4s opacity;
    }

    #zone_capsules
    {
        display:block;
        position:absolute;
        width:100%;
        height:70vh;
        margin-left:0;
        margin-top:2vh;

        transition: 0.4s opacity;
    }

    .no_display
    {
        display:none;
        height:0;
        width:0;
        opacity:0;
        z-index:-1;
    }

    .centered_paragraph
    {
        width:100%;

        color:rgba(230,230,230,1);
        font-size:2.1vh;
        font-family:"Neucha";
        text-align:center;
        margin-top:4.2vh;

        text-shadow:1px 1px 1px rgba(0,0,0,0.8);
    }

    .selector_wrapper
    {
        position: relative;
        display: inline-block;
        border:red 0px solid;
    }

    #wrapper_day
    {
        width:20%;
        margin-left:9%;
    }

    #wrapper_month
    {
        width:30%;
        margin-left:5%;
    }

    #wrapper_year
    {
        width:20%;
        margin-left:5%;
    }

    #wrapper_life
    {
        width:60%;
        margin-left:20%;
    }

    #wrapper_sleep
    {
        width:30%;
        margin-left:35%;
    }

    .selector
    {
        height:3.8vh;
        width:100%;
        background-color:rgba(0,0,0,0.12);
        font-size:1.6vh;
        text-shadow:1px 1px 1px rgba(0,0,0,0.8);

        border:1px solid rgba(0,0,0,0.05);
        transition:0.3s background-color, 0.3s text-shadow;
    }

    .selector:hover
    {
        background-color:rgba(40,220,255,0.4);
        text-shadow:0px 0px 1px rgba(0,0,0,0.4);
        text-shadow:0px 0px 6px rgba(255,255,255,0.5);
    }

    .selector_content
    {
        display: block;
        width:100%;
        max-height:39vh;
        overflow:auto;
        position: absolute;
        z-index: 2;
    }

    .option
    {
        background-color:rgba(26, 121, 153,1);
        border:1px solid rgba( 22, 115, 145,1);
        display:block;
        height:2.8vh;
        font-size:1.4vh;
        width:100%;
        transition:0.2s background-color;
    }

    .option:hover
    {
        background-color:rgba(35, 138, 170,1);
    }

    #alert_data
    {
        width:100%;
        text-align:center;
        font-size:1.6vh;
        height:2.4vh;
        margin-top:3vh;
        margin-bottom:0;
        font-family:"Neucha";

    }

    .white_text
    {
        color:rgba(255,255,255, 0.8);
    }

    .transparent_text
    {
        color:rgba(255,255,255,0);
    }

    #calculate_button
    {
        display:block;
        width:36%;
        height:11vh;
        margin-left:32%;
        margin-top:0vh;
        font-size:1.6vh;
        text-shadow:0px 0px 1px rgba(0,0,0,0.4);
        background-color:rgba(178, 26, 52, 1);
        box-shadow:0px 1.2vh 0px rgba(50,0,0,0.75);

        border:0px solid rgba(10,135,140,1);
        border-radius:60px;

        transition:0.15s margin, 0.17s box-shadow, 0.4s background-color, 0.4s text-shadow;
    }

    #calculate_button:hover
    {
        background-color:rgba(140, 0, 18,1);
        text-shadow:0px 0px 1px rgba(0,0,0,0.4);
        text-shadow:0px 0px 6px rgba(255,255,255,0.9);
    }

    #calculate_button:active
    {
        box-shadow:0px 0vh 0px rgba(50,0,0,0.75);
        margin-top:1.2vh;
    }

    .capsule_row
    {
        height:0.63vh;
        margin-top:0px;
        margin-left:6%;
    }

    .capsule
    {
        display:inline-block;
        height:100%;;
        width:0.25%;
        margin-left:0px;
        border:1px solid rgba(0,0,0,0.3);
        background-color:rgb(165, 237, 239);
    }

    .lived
    {
        background-color:rgb(87, 134, 142);
    }

    .slept
    {
        background-color:rgb(27, 127, 153);
    }

    .sleep
    {
        background-color:rgb(106, 232, 237);
    }



    @media screen and (max-aspect-ratio: 8/5)
    {
        #zone_calculator
        {
            width:36%;
            margin-left:32%;
        }

        .mainbutton
        {
            width:13%;
        }

        #leftbutton
        {
            margin-left:28.5%;
        }
    }

    @media screen and (max-aspect-ratio: 8/8)
    {
        #zone_calculator
        {
            width:72%;
            margin-left:14%;
        }

        .mainbutton
        {
            width:25%;
        }

        #leftbutton
        {
            margin-left:10.5%;
        }


    }
</style></head>

<body>
    <div id="whole">
        <div id="title">WHOA CALENDAR</div>
        <div id="main_buttonbar">
            <button class="mainbutton mainbutton_pressed" id="leftbutton">CALCULATE</button>
            <button class="mainbutton" id="midbutton">ABOUT</button>
            <button class="mainbutton" id="rightbutton"></button>
        </div>
        <div id="container">
            <div id="zone_calculator">
                <p class="centered_paragraph">Your date of birth:</p>
                <div id="wrapper_day" class="selector_wrapper">
                    <button id="day_select" class="selector">- DAY -</button>
                    <div class="selector_content no_display">
                        <!--populated from script-->
                    </div>
                </div>
                <div id="wrapper_month" class="selector_wrapper">
                    <button id="month_select" class="selector">- MONTH -</button>
                    <div class="selector_content no_display">
                        <!--populated from script-->
                    </div>
                </div>
                <div id="wrapper_year" class="selector_wrapper">
                    <button id="year_select" class="selector">- YEAR -</button>
                    <div class="selector_content no_display">
                        <!--populated from script-->
                    </div>
                </div>
                <p class="centered_paragraph">How long do you think you'll live?</p>
                <div id="wrapper_life" class="selector_wrapper">
                    <button id="life_select" class="selector">- LIFESPAN -</button>
                    <div class="selector_content no_display">
                        <button class="option">100 years</button>
                        <button class="option">90 years</button>
                        <button class="option">84 years (female life expectancy in EU)</button>
                        <button class="option">81 years (life expectancy in EU)</button>
                        <button class="option">78 years (male life expectancy in EU)</button>
                        <button class="option">70 years</button>
                    </div>
                </div>
                <p class="centered_paragraph">How many hours a day do you sleep?</p>
                <div id="wrapper_sleep" class="selector_wrapper">
                    <button id="sleep_select" class="selector">- SLEEP -</button>
                    <div class="selector_content no_display">
                        <!--populated from script-->
                    </div>
                </div>
                <p id="alert_data" class="white_text transparent_text">Invalid data.</p>
                <button id="calculate_button">CALCULATE</button>
                
            </div>
            <div id="zone_about" class="no_display">
                <p class="centered_paragraph">About</p>
            </div>
            <div id="zone_explore" class="no_display">
                
            </div>
            <div id="zone_capsules" class="no_display">
                <div class="capsule_row">

                </div>
            </div>
        </div>
        
    </div>
</body>
<script>
    PopulateSelectors();
    function PopulateSelectors()
    {
        for (i = 1950; i < 2017; i++) {
            $('#wrapper_year > .selector_content').prepend('<button class="option">' + i + '</button>');
        }

        for (i = 1; i < 32; i++) {
            if (i >= 10) {
                $('#wrapper_day > .selector_content').append('<button class="option">' + i + '</button>');
            }
            else {
                $('#wrapper_day > .selector_content').append('<button class="option">0' + i + '</button>');
            }
        }

        for (i = 1; i < 13; i++) {
            if (i >= 10) {
                $('#wrapper_month > .selector_content').append('<button class="option">' + i + '</button>');
            }
            else {
                $('#wrapper_month > .selector_content').append('<button class="option">0' + i + '</button>');
            }
        }

        for (i = 4; i < 13; i++) {
            $('#wrapper_sleep > .selector_content').append('<button class="option">' + i + '</button>');
        }
    }
    

    var clicked = [true, false, false];

    $('#leftbutton').click(function ()
    {
        ClickFunction(0);
    });

    $('#midbutton').click(function () {
        ClickFunction(1);
    });

    $('#rightbutton').click(function () {
        ClickFunction(2);
    });

    function ClickFunction(which)
    {
        switch(which)
        {
            case 0:
                if (clicked[which] == false) {
                    clicked[1] = false;
                    clicked[2] = false;
                    $('#leftbutton').addClass("mainbutton_pressed");
                    $('#midbutton').removeClass("mainbutton_pressed");
                    $('#rightbutton').removeClass("mainbutton_pressed");
                    clicked[which] = !clicked[which];
                    $('#zone_about').addClass("no_display");
                    $('#zone_explore').addClass("no_display");
                    $('#zone_calculator').removeClass("no_display");
                }
                
                break;
            case 1:
                if (clicked[which] == false) {
                    clicked[0] = false;
                    clicked[2] = false;
                    $('#midbutton').addClass("mainbutton_pressed");
                    $('#leftbutton').removeClass("mainbutton_pressed");
                    $('#rightbutton').removeClass("mainbutton_pressed");
                    clicked[which] = !clicked[which];
                    $('#zone_calculator').addClass("no_display");
                    $('#zone_explore').addClass("no_display");
                    $('#zone_about').removeClass("no_display");
                }
                break;
            case 2:
                if (clicked[which] == false) {
                    clicked[0] = false;
                    clicked[1] = false;
                    $('#rightbutton').addClass("mainbutton_pressed");
                    $('#leftbutton').removeClass("mainbutton_pressed");
                    $('#midbutton').removeClass("mainbutton_pressed");
                    clicked[which] = !clicked[which];
                    $('#zone_calculator').addClass("no_display");
                    $('#zone_about').addClass("no_display");
                    $('#zone_explore').removeClass("no_display");
                }
                break;
            default:
                break;
        }
        
    }

    $('#day_select').click(function () {
        $('#wrapper_day > .selector_content').toggleClass("no_display");
    });

    $('#month_select').click(function () {
        $('#wrapper_month > .selector_content').toggleClass("no_display");
    });

    $('#year_select').click(function () {
        $('#wrapper_year > .selector_content').toggleClass("no_display");
    });

    $('#life_select').click(function () {
        $('#wrapper_life > .selector_content').toggleClass("no_display");
    });

    $('#sleep_select').click(function () {
        $('#wrapper_sleep > .selector_content').toggleClass("no_display");
    });

    //============= INPUT HANDLING =============
    var b_day = "00";
    var b_month = "00";
    var b_year = "0000";
    var lifespan = 0;
    var sleep = 0;
    $('#wrapper_day > .selector_content > .option').click(function () {
        b_day = $(this).text();
        $('#day_select').html(b_day);
        $('#wrapper_day > .selector_content').addClass("no_display");
    });

    $('#wrapper_month > .selector_content > .option').click(function () {
        b_month = $(this).text();
        $('#month_select').html(b_month);
        $('#wrapper_month > .selector_content').addClass("no_display");
    });

    $('#wrapper_year > .selector_content > .option').click(function () {
        b_year = $(this).text();
        $('#year_select').html(b_year);
        $('#wrapper_year > .selector_content').addClass("no_display");
    });

    $('#wrapper_life > .selector_content > .option').click(function () {
        lifespan = $(this).text().substring(0, 3);
        lifespan = lifespan.replace(/\s+/g, '');
        lifespan = parseInt(lifespan, 10);
        $('#life_select').html(lifespan);
        $('#wrapper_life > .selector_content').addClass("no_display");
    });

    $('#wrapper_sleep > .selector_content > .option').click(function () {
        sleep = parseInt($(this).text(),10);
        $('#sleep_select').html(sleep);
        $('#wrapper_sleep > .selector_content').addClass("no_display");
    });

    var counter = 1;
    var sleep_days = 0;
    var slept_days = 0;
    var lived_days = 0;
    var future_sleep_contr = 0;
    var days = 0;
    var one_day = 24 * 60 * 60 * 1000;
    var controller = true;
    //================= ACTUAL CALCULATION =================
    $('#calculate_button').click(function () {
        if((b_day == "00" || b_month == "00" || b_year == "0000" || lifespan == 0 || sleep == 0)
          || ((b_month == "04" || b_month == "06" || b_month == "09" || b_month == "11") && b_day == "31")
          || (b_month == "02" && parseInt(b_day, 10) > 29)
          || (IsLeapYear(parseInt(b_year,10)) == false && b_month == "02" && b_day == "29"))
        {
            //invalid info
            $('#alert_data').removeClass("transparent_text");
        }
        else
        {
            var current_date = new Date();
            current_date.setHours(0, 0, 0, 0);
            var birthday = new Date(b_year + "-" + b_month + "-" + b_day);
            b_year = parseInt(b_year, 10);
            var future_date = new Date((b_year + lifespan) + "-" + b_month + "-" + b_day);
            
            days = Math.round(Math.abs((future_date.getTime() - birthday.getTime()) / (one_day)));
            lived_days = Math.round(Math.abs((current_date.getTime() - birthday.getTime()) / (one_day)));
            sleep_days = Math.round((days - lived_days) * sleep / 24);
            slept_days = Math.round(lived_days * sleep / 24);
            future_sleep_contr = sleep_days + lived_days;
            setTimeout("HideCalcu()", 75);
            setTimeout("SpawnCapsules()", 100);
        }
    });

    function HideCalcu()
    {
        counter = 1;
        $('#zone_calculator').addClass("no_display");
        $('#main_buttonbar').addClass("no_display");
        $('#zone_capsules').removeClass("no_display");
    }

    function SpawnCapsules()
    {
        controller = true;
        while (controller == true)
        {
            if(counter <= days)
            {
                
                if (counter <= lived_days)
                {
                    if (counter <= slept_days)
                    {
                        $('#zone_capsules > .capsule_row:last').append('<div class="capsule slept"></div>');
                    }
                    else
                    {
                        $('#zone_capsules > .capsule_row:last').append('<div class="capsule lived"></div>');
                    }
                }
                else
                {
                    if(counter > lived_days && counter <= (future_sleep_contr))
                    {
                        $('#zone_capsules > .capsule_row:last').append('<div class="capsule sleep"></div>');
                    }
                    else
                    {
                        $('#zone_capsules > .capsule_row:last').append('<div class="capsule"></div>');
                    }
                }
                
                if (counter % 365 == 0)
                {
                    //new line
                    $('#zone_capsules').append('<div class="capsule_row"></div>');
                    controller = false;
                    setTimeout("SpawnCapsules()", 20);
                }
                if (counter == days)
                {
                    controller = false;
                }
                counter += 1;
            }
        }
    }

    function IsLeapYear(year)
    {
        return ((year % 4 == 0) && (year % 100 != 0)) || (year % 400 == 0);
    }
</script>
</html>